CREATE TABLE m6aacureuqp9xsmy.ADVANCES (
	nroDNI INT NOT NULL,
	`date` DATE NOT NULL,
	amount INT NOT NULL,
	pay INT NOT NULL,
	active BOOL DEFAULT 1 NOT NULL
)
ENGINE=InnoDB
DEFAULT CHARSET=utf8mb4
COLLATE=utf8mb4_unicode_ci;

ALTER TABLE m6aacureuqp9xsmy.ADVANCES ADD CONSTRAINT ADVANCES_PK PRIMARY KEY (nroDNI,`date`);

CREATE TABLE m6aacureuqp9xsmy.INSTALLMENTS (
	nroDNI INT NOT NULL,
	`date` DATE NOT NULL,
	`month` DATE NOT NULL,
	amount INT NOT NULL,
	label varchar(100) NOT NULL,
	CONSTRAINT INSTALLMENTS_PK PRIMARY KEY (nroDNI,`date`,`month`),
	CONSTRAINT INSTALLMENTS_FK FOREIGN KEY (nroDNI,`date`) REFERENCES m6aacureuqp9xsmy.ADVANCES(nroDNI,`date`)
)
ENGINE=InnoDB
DEFAULT CHARSET=utf8mb4
COLLATE=utf8mb4_unicode_ci;

ALTER TABLE m6aacureuqp9xsmy.INSTALLMENTS MODIFY COLUMN nroDNI INT NOT NULL;
ALTER TABLE m6aacureuqp9xsmy.INSTALLMENTS DROP FOREIGN KEY INSTALLMENTS_FK;

ALTER TABLE m6aacureuqp9xsmy.INSTALLMENTS MODIFY COLUMN nroDNI BIGINT NOT NULL;

ALTER TABLE m6aacureuqp9xsmy.ADVANCES MODIFY COLUMN nroDNI BIGINT NOT NULL;

ALTER TABLE m6aacureuqp9xsmy.ADVANCES ADD CONSTRAINT ADVANCES_FK FOREIGN KEY (nroDNI) REFERENCES m6aacureuqp9xsmy.EMPLOYEES(dni);

ALTER TABLE m6aacureuqp9xsmy.INSTALLMENTS ADD CONSTRAINT INSTALLMENTS_FK FOREIGN KEY (nroDNI,`date`) REFERENCES m6aacureuqp9xsmy.ADVANCES(nroDNI,`date`);

ALTER TABLE m6aacureuqp9xsmy.ADVANCES DROP FOREIGN KEY ADVANCES_FK;
ALTER TABLE m6aacureuqp9xsmy.ADVANCES ADD CONSTRAINT ADVANCES_FK FOREIGN KEY (nroDNI) REFERENCES m6aacureuqp9xsmy.EMPLOYEES(dni) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE m6aacureuqp9xsmy.INSTALLMENTS ADD pay BOOL DEFAULT 0 NOT NULL;

ALTER TABLE m6aacureuqp9xsmy.ADVANCES DROP COLUMN active;
